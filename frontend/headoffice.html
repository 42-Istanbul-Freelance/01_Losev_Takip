<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <title>L√ñSEV ƒ∞nci - Genel Merkez Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        losev: {
                            red: '#d62828',
                            redSoft: '#fcd5ce',
                            redDark: '#9e0000',
                            green: '#2e7d32',
                            greenSoft: '#e8f5e9',
                            orange: '#f77f00',
                            orangeSoft: '#ffecd1',
                            blue: '#457b9d',
                            blueSoft: '#e0fbfc'
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.03);
            border-radius: 1.5rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }
        .nav-item {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .nav-active {
            background: #d62828;
            color: white;
            box-shadow: 0 4px 12px rgba(214, 40, 40, 0.3);
        }
        .nav-inactive {
            color: #64748b;
        }
        .nav-inactive:hover {
            background: #f1f5f9;
            color: #1e293b;
        }
        .hidden-panel { display: none !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen">

    <!-- Sidebar -->
    <aside class="fixed top-0 left-0 h-full w-64 bg-white border-r border-slate-200 z-50 hidden md:flex flex-col">
        <div class="p-6 border-b border-slate-100">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-losev-red text-white flex items-center justify-center font-black text-lg">L</div>
                <div>
                    <h1 class="font-black text-slate-800 text-sm leading-tight">L√ñSEV ƒ∞NCƒ∞</h1>
                    <p class="text-[0.65rem] font-bold text-slate-400 uppercase tracking-wider">Genel Merkez</p>
                </div>
            </div>
        </div>

        <div class="p-4 border-b border-slate-100">
            <div class="flex items-center gap-3 p-3 rounded-xl bg-slate-50">
                <div class="w-10 h-10 rounded-full bg-losev-red/10 text-losev-red flex items-center justify-center font-bold" id="userInitials">GM</div>
                <div class="overflow-hidden">
                    <p class="font-bold text-sm text-slate-800 truncate" id="userName">Genel Merkez</p>
                    <p class="text-xs text-slate-500">Y√∂netici</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 p-4 space-y-2" id="sidebarNav">
            <button onclick="switchSection('dashboard')" id="nav_dashboard" class="nav-item nav-active">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                Genel Bakƒ±≈ü
            </button>
            <button onclick="switchSection('activities')" id="nav_activities" class="nav-item nav-inactive">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                Faaliyetler
            </button>
            <button onclick="switchSection('students')" id="nav_students" class="nav-item nav-inactive">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm6 0h-3.5a6 6 0 00-3.5-1v-1a6 6 0 013.5-1H21v2z"></path></svg>
                √ñƒürenciler
            </button>
            <button onclick="switchSection('reports')" id="nav_reports" class="nav-item nav-inactive">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                Raporlar
            </button>
            <button onclick="switchSection('cities')" id="nav_cities" class="nav-item nav-inactive">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"></path></svg>
                ƒ∞l Bazlƒ± Analiz
            </button>
        </nav>

        <div class="p-4 border-t border-slate-100">
            <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-losev-red transition font-semibold text-sm">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                √áƒ±kƒ±≈ü Yap
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="md:ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
            <div class="flex items-center justify-between px-6 py-4">
                <h2 id="pageTitle" class="text-xl font-bold text-slate-800">Genel Bakƒ±≈ü</h2>
                <div class="flex items-center gap-4">
                    <span class="px-3 py-1 rounded-full bg-losev-red/10 text-losev-red text-xs font-bold" id="liveIndicator">‚óè CANLI</span>
                </div>
            </div>
        </header>

        <div class="p-6">
            <!-- DASHBOARD SECTION -->
            <section id="viewDashboard" class="space-y-6">
                <!-- Badge Cards - Student Badges -->
                <div class="mb-6">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        Dijital Sertifika Sistemi
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="stat-card border-l-4 border-amber-600">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center text-white text-xl">ü•â</div>
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase">25+ Saat</p>
                                    <p class="font-black text-slate-800">Bronz ƒ∞nci</p>
                                    <p class="text-xs text-amber-600 font-semibold" id="bronzeCount">- √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card border-l-4 border-slate-400">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-slate-400 to-slate-600 flex items-center justify-center text-white text-xl">ü•à</div>
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase">50+ Saat</p>
                                    <p class="font-black text-slate-800">G√ºm√º≈ü ƒ∞nci</p>
                                    <p class="text-xs text-slate-500 font-semibold" id="silverCount">- √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card border-l-4 border-yellow-500">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center text-white text-xl">ü•á</div>
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase">100+ Saat</p>
                                    <p class="font-black text-slate-800">Altƒ±n ƒ∞nci</p>
                                    <p class="text-xs text-yellow-600 font-semibold" id="goldCount">- √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card border-l-4 border-purple-600">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-600 to-purple-800 flex items-center justify-center text-white text-xl">üëë</div>
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase">200+ Saat</p>
                                    <p class="font-black text-slate-800">Platin ƒ∞nci</p>
                                    <p class="text-xs text-purple-600 font-semibold" id="platinumCount">- √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- School Performance Badges -->
                <div class="mb-6">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-losev-blue" fill="currentColor" viewBox="0 0 20 20"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.509-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/></svg>
                        Okul Performans Rozetleri
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="stat-card bg-gradient-to-br from-losev-red/5 to-losev-red/10 border border-losev-red/20">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-losev-red to-rose-600 flex items-center justify-center text-white shadow-lg">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                </div>
                                <div>
                                    <p class="font-black text-lg text-slate-800">üèÜ Yƒ±lƒ±n En Aktif ƒ∞nci Okulu</p>
                                    <p class="text-sm text-losev-red font-semibold" id="topSchool1">ƒ∞stanbul Lisesi</p>
                                    <p class="text-xs text-slate-500">4,230 saat | 156 √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card bg-gradient-to-br from-losev-blue/5 to-losev-blue/10 border border-losev-blue/20">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-losev-blue to-blue-600 flex items-center justify-center text-white shadow-lg">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/></svg>
                                </div>
                                <div>
                                    <p class="font-black text-lg text-slate-800">üåü Sosyal Etki Lideri Okul</p>
                                    <p class="text-sm text-losev-blue font-semibold" id="topSchool2">Ankara Fen Lisesi</p>
                                    <p class="text-xs text-slate-500">3,890 saat | 142 √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card bg-gradient-to-br from-losev-green/5 to-losev-green/10 border border-losev-green/20">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-losev-green to-green-600 flex items-center justify-center text-white shadow-lg">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg>
                                </div>
                                <div>
                                    <p class="font-black text-lg text-slate-800">üíö ƒ∞nci Dostu Okul</p>
                                    <p class="text-sm text-losev-green font-semibold" id="topSchool3">ƒ∞zmir Anadolu Lisesi</p>
                                    <p class="text-xs text-slate-500">2,450 saat | 98 √∂ƒürenci</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Toplam √ñƒürenci</p>
                        <p class="text-3xl font-black text-slate-800 mt-2" id="statStudents">-</p>
                        <p class="text-xs text-slate-500 mt-1">12 ilden katƒ±lƒ±m</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Toplam √ñƒüretmen</p>
                        <p class="text-3xl font-black text-slate-800 mt-2" id="statTeachers">-</p>
                        <p class="text-xs text-slate-500 mt-1">Koordinat√∂r sayƒ±sƒ±</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">G√∂n√ºll√ºl√ºk Saati</p>
                        <p class="text-3xl font-black text-losev-blue mt-2" id="statHours">-</p>
                        <p class="text-xs text-slate-500 mt-1">T√ºm etkinlikler</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Bekleyen Onay</p>
                        <p class="text-3xl font-black text-losev-orange mt-2" id="statPending">-</p>
                        <p class="text-xs text-slate-500 mt-1">Onay bekleyen</p>
                    </div>
                </div>

                <!-- Turkey Map Section -->
                <div class="glass-card p-6">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-losev-red" fill="currentColor" viewBox="0 0 20 20"><path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        T√ºrkiye G√∂n√ºll√ºl√ºk Haritasƒ± - ƒ∞l Bazlƒ± Etki Analizi
                    </h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <div id="turkeyMap" class="w-full h-80 bg-slate-50 rounded-xl relative overflow-hidden">
                                <!-- Interactive Turkey Map SVG -->
                                <svg viewBox="0 0 800 400" class="w-full h-full">
                                    <!-- Background -->
                                    <rect width="800" height="400" fill="#f8fafc"/>
                                    
                                    <!-- City Points with Heat Colors -->
                                    <!-- Istanbul - High Activity (Red) -->
                                    <circle cx="160" cy="120" r="20" fill="#d62828" opacity="0.8"/>
                                    <text x="160" y="155" text-anchor="middle" font-size="11" font-weight="bold" fill="#1e293b">ƒ∞stanbul</text>
                                    <text x="160" y="170" text-anchor="middle" font-size="9" fill="#64748b">245 √∂ƒür. | 6,780s</text>
                                    
                                    <!-- Ankara - High Activity (Orange-Red) -->
                                    <circle cx="320" cy="160" r="18" fill="#f94144" opacity="0.8"/>
                                    <text x="320" y="195" text-anchor="middle" font-size="11" font-weight="bold" fill="#1e293b">Ankara</text>
                                    <text x="320" y="210" text-anchor="middle" font-size="9" fill="#64748b">189 √∂ƒür. | 5,230s</text>
                                    
                                    <!-- Izmir - Medium-High (Orange) -->
                                    <circle cx="100" cy="240" r="16" fill="#f77f00" opacity="0.8"/>
                                    <text x="100" y="275" text-anchor="middle" font-size="11" font-weight="bold" fill="#1e293b">ƒ∞zmir</text>
                                    <text x="100" y="290" text-anchor="middle" font-size="9" fill="#64748b">156 √∂ƒür. | 4,120s</text>
                                    
                                    <!-- Adana - Medium (Yellow-Orange) -->
                                    <circle cx="400" cy="280" r="14" fill="#f9c74f" opacity="0.8"/>
                                    <text x="400" y="315" text-anchor="middle" font-size="11" font-weight="bold" fill="#1e293b">Adana</text>
                                    <text x="400" y="330" text-anchor="middle" font-size="9" fill="#64748b">134 √∂ƒür. | 3,450s</text>
                                    
                                    <!-- Bursa - Medium (Yellow) -->
                                    <circle cx="180" cy="140" r="12" fill="#90be6d" opacity="0.8"/>
                                    <text x="180" y="110" text-anchor="middle" font-size="10" font-weight="bold" fill="#1e293b">Bursa</text>
                                    <text x="180" y="98" text-anchor="middle" font-size="8" fill="#64748b">98 √∂ƒür.</text>
                                    
                                    <!-- Antalya - Medium (Green-Yellow) -->
                                    <circle cx="220" cy="300" r="12" fill="#43aa8b" opacity="0.8"/>
                                    <text x="220" y="335" text-anchor="middle" font-size="10" font-weight="bold" fill="#1e293b">Antalya</text>
                                    <text x="220" y="347" text-anchor="middle" font-size="8" fill="#64748b">87 √∂ƒür.</text>
                                    
                                    <!-- Konya - Smaller (Green) -->
                                    <circle cx="300" cy="240" r="10" fill="#577590" opacity="0.8"/>
                                    <text x="300" y="270" text-anchor="middle" font-size="9" font-weight="bold" fill="#1e293b">Konya</text>
                                    <text x="300" y="280" text-anchor="middle" font-size="8" fill="#64748b">76</text>
                                    
                                    <!-- Gaziantep -->
                                    <circle cx="450" cy="260" r="9" fill="#6c757d" opacity="0.8"/>
                                    <text x="450" y="290" text-anchor="middle" font-size="9" font-weight="bold" fill="#1e293b">Gaziantep</text>
                                    
                                    <!-- Mersin -->
                                    <circle cx="360" cy="300" r="8" fill="#6c757d" opacity="0.8"/>
                                    <text x="360" y="325" text-anchor="middle" font-size="9" fill="#64748b">Mersin</text>
                                    
                                    <!-- Trabzon - North -->
                                    <circle cx="520" cy="80" r="8" fill="#6c757d" opacity="0.8"/>
                                    <text x="520" y="65" text-anchor="middle" font-size="9" font-weight="bold" fill="#1e293b">Trabzon</text>
                                    
                                    <!-- Samsun - North -->
                                    <circle cx="440" cy="70" r="7" fill="#6c757d" opacity="0.8"/>
                                    <text x="440" y="55" text-anchor="middle" font-size="9" fill="#64748b">Samsun</text>
                                    
                                    <!-- Eski≈üehir -->
                                    <circle cx="260" cy="150" r="7" fill="#6c757d" opacity="0.8"/>
                                    <text x="260" y="135" text-anchor="middle" font-size="9" fill="#64748b">Eski≈üehir</text>
                                    
                                    <!-- Legend -->
                                    <g transform="translate(600, 320)">
                                        <rect width="180" height="70" fill="white" stroke="#e2e8f0" rx="8"/>
                                        <text x="10" y="20" font-size="11" font-weight="bold" fill="#1e293b">Yoƒüunluk Haritasƒ±</text>
                                        <circle cx="20" cy="38" r="8" fill="#d62828" opacity="0.8"/>
                                        <text x="35" y="42" font-size="9" fill="#64748b">Y√ºksek (200+)</text>
                                        <circle cx="20" cy="55" r="6" fill="#f77f00" opacity="0.8"/>
                                        <text x="30" y="59" font-size="9" fill="#64748b">Orta (50-200)</text>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-slate-50 rounded-xl p-4">
                                <h4 class="font-bold text-slate-800 mb-3 text-sm">ƒ∞l Bazlƒ± Top 5</h4>
                                <div id="cityRankingList" class="space-y-2">
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm">
                                        <span class="font-semibold text-sm">1. ƒ∞stanbul</span>
                                        <span class="text-xs font-bold text-losev-blue">6,780 saat</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm">
                                        <span class="font-semibold text-sm">2. Ankara</span>
                                        <span class="text-xs font-bold text-losev-blue">5,230 saat</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm">
                                        <span class="font-semibold text-sm">3. ƒ∞zmir</span>
                                        <span class="text-xs font-bold text-losev-blue">4,120 saat</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm">
                                        <span class="font-semibold text-sm">4. Adana</span>
                                        <span class="text-xs font-bold text-losev-blue">3,450 saat</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm">
                                        <span class="font-semibold text-sm">5. Bursa</span>
                                        <span class="text-xs font-bold text-losev-blue">2,890 saat</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-slate-50 rounded-xl p-4">
                                <h4 class="font-bold text-slate-800 mb-3 text-sm">Genel ƒ∞statistikler</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-slate-500">Toplam ƒ∞l:</span>
                                        <span class="font-bold">12</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-500">Toplam Okul:</span>
                                        <span class="font-bold">51</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-500">Ort. Saat/√ñƒürenci:</span>
                                        <span class="font-bold text-losev-blue">28.5</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-500">Onaylanan Faaliyet:</span>
                                        <span class="font-bold text-losev-green">3,450</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Aylƒ±k Faaliyet Daƒüƒ±lƒ±mƒ±</h3>
                        <canvas id="monthlyChart" height="200"></canvas>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Etkinlik T√ºr√º Daƒüƒ±lƒ±mƒ±</h3>
                        <canvas id="activityTypeChart" height="200"></canvas>
                    </div>
                </div>

                <!-- Top Lists -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="text-amber-500">‚≠ê</span> En Aktif √ñƒürenciler (Top 10)
                        </h3>
                        <div id="topStudentsList" class="space-y-3">
                            <p class="text-sm text-slate-400 text-center py-4">Y√ºkleniyor...</p>
                        </div>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="text-losev-blue">üè´</span> En Aktif Okullar (Top 10)
                        </h3>
                        <div id="topSchoolsList" class="space-y-3">
                            <p class="text-sm text-slate-400 text-center py-4">Y√ºkleniyor...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ACTIVITIES SECTION -->
            <section id="viewActivities" class="hidden-panel space-y-6">
                <div class="flex items-center justify-between">
                    <div class="flex gap-2">
                        <button onclick="filterActivities('all')" class="px-4 py-2 rounded-lg text-sm font-semibold bg-losev-red text-white" id="filterAll">T√ºm√º</button>
                        <button onclick="filterActivities('pending')" class="px-4 py-2 rounded-lg text-sm font-semibold bg-white text-slate-600 border border-slate-200" id="filterPending">Bekleyen</button>
                        <button onclick="filterActivities('approved')" class="px-4 py-2 rounded-lg text-sm font-semibold bg-white text-slate-600 border border-slate-200" id="filterApproved">Onaylanan</button>
                    </div>
                </div>

                <div class="glass-card overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50">
                            <tr class="text-xs font-bold text-slate-500 uppercase">
                                <th class="py-3 px-4">√ñƒürenci</th>
                                <th class="py-3 px-4">Okul</th>
                                <th class="py-3 px-4">Etkinlik</th>
                                <th class="py-3 px-4 text-center">Saat</th>
                                <th class="py-3 px-4 text-center">Durum</th>
                                <th class="py-3 px-4 text-right">ƒ∞≈ülem</th>
                            </tr>
                        </thead>
                        <tbody id="activitiesTableBody" class="divide-y divide-slate-100">
                            <tr><td colspan="6" class="py-12 text-center text-slate-400">Y√ºkleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- STUDENTS SECTION -->
            <section id="viewStudents" class="hidden-panel space-y-6">
                <div class="glass-card p-4">
                    <input type="text" id="studentSearch" placeholder="√ñƒürenci ara..." class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:border-losev-red focus:ring-2 focus:ring-losev-red/20 outline-none" onkeyup="searchStudents()">
                </div>

                <div class="glass-card overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50">
                            <tr class="text-xs font-bold text-slate-500 uppercase">
                                <th class="py-3 px-4">Ad Soyad</th>
                                <th class="py-3 px-4">Okul</th>
                                <th class="py-3 px-4">ƒ∞l/ƒ∞l√ße</th>
                                <th class="py-3 px-4">Sƒ±nƒ±f</th>
                                <th class="py-3 px-4">Koordinat√∂r</th>
                                <th class="py-3 px-4 text-center">ƒ∞≈ülem</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody" class="divide-y divide-slate-100">
                            <tr><td colspan="6" class="py-12 text-center text-slate-400">Y√ºkleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- REPORTS SECTION -->
            <section id="viewReports" class="hidden-panel space-y-6">
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Toplam Okul</p>
                        <p class="text-2xl font-black text-slate-800 mt-2" id="statTotalSchools">-</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Toplam ƒ∞l</p>
                        <p class="text-2xl font-black text-slate-800 mt-2" id="statTotalCities">-</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Onaylanan Faaliyet</p>
                        <p class="text-2xl font-black text-losev-green mt-2" id="statApprovedActivities">-</p>
                    </div>
                </div>

                <div class="glass-card p-6">
                    <h3 class="font-bold text-slate-800 mb-4">Okul Performans Tablosu</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50">
                                <tr class="text-xs font-bold text-slate-500 uppercase">
                                    <th class="py-3 px-4">#</th>
                                    <th class="py-3 px-4">Okul</th>
                                    <th class="py-3 px-4 text-center">√ñƒürenci Sayƒ±sƒ±</th>
                                    <th class="py-3 px-4 text-center">Toplam Saat</th>
                                    <th class="py-3 px-4 text-center">Ort. Saat/√ñƒürenci</th>
                                </tr>
                            </thead>
                            <tbody id="schoolsReportTable" class="divide-y divide-slate-100">
                                <tr><td colspan="5" class="py-12 text-center text-slate-400">Y√ºkleniyor...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- CITIES SECTION -->
            <section id="viewCities" class="hidden-panel space-y-6">
                <div class="glass-card p-6">
                    <h3 class="font-bold text-slate-800 mb-4">ƒ∞l Bazlƒ± Etki Analizi</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50">
                                <tr class="text-xs font-bold text-slate-500 uppercase">
                                    <th class="py-3 px-4">#</th>
                                    <th class="py-3 px-4">ƒ∞l</th>
                                    <th class="py-3 px-4 text-center">√ñƒürenci Sayƒ±sƒ±</th>
                                    <th class="py-3 px-4 text-center">Faaliyet Sayƒ±sƒ±</th>
                                    <th class="py-3 px-4 text-center">Toplam Saat</th>
                                </tr>
                            </thead>
                            <tbody id="citiesTable" class="divide-y divide-slate-100">
                                <tr><td colspan="5" class="py-12 text-center text-slate-400">Y√ºkleniyor...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">ƒ∞l Daƒüƒ±lƒ±mƒ± (Pasta Grafiƒüi)</h3>
                        <canvas id="cityChart" height="250"></canvas>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Saat Bazlƒ± ƒ∞l Sƒ±ralamasƒ±</h3>
                        <canvas id="cityHoursChart" height="250"></canvas>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        const API_BASE = '/api';
        let currentActivityFilter = 'all';
        let allActivities = [];
        let allStudents = [];

        // Auth check
        const authUser = localStorage.getItem('auth_user');
        if (!authUser) window.location.href = 'login.html';
        const user = JSON.parse(authUser);
        if (user.role !== 'headoffice') window.location.href = 'dashboard.html';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('userName').textContent = `${user.firstName} ${user.lastName}`;
            document.getElementById('userInitials').textContent = `${user.firstName[0]}${user.lastName[0]}`;

            loadDashboard();
            loadActivities();
            loadStudents();
            loadReports();
            loadCityStats();
        });

        function switchSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-panel'));
            document.getElementById(`view${section.charAt(0).toUpperCase() + section.slice(1)}`).classList.remove('hidden-panel');

            document.querySelectorAll('.nav-item').forEach(n => {
                n.classList.remove('nav-active');
                n.classList.add('nav-inactive');
            });
            document.getElementById(`nav_${section}`).classList.remove('nav-inactive');
            document.getElementById(`nav_${section}`).classList.add('nav-active');

            const titles = {
                dashboard: 'Genel Bakƒ±≈ü',
                activities: 'Faaliyetler',
                students: '√ñƒürenciler',
                reports: 'Raporlar',
                cities: 'ƒ∞l Bazlƒ± Analiz'
            };
            document.getElementById('pageTitle').textContent = titles[section];
        }

        function logout() {
            localStorage.removeItem('auth_user');
            window.location.href = 'login.html';
        }

        async function apiRequest(endpoint, method = 'GET', body = null) {
            const opts = { method, headers: {} };
            if (body) {
                opts.headers['Content-Type'] = 'application/json';
                opts.body = JSON.stringify(body);
            }
            const res = await fetch(API_BASE + endpoint, opts);
            const data = await res.json().catch(() => ({}));
            if (!res.ok) throw new Error(data.error || 'Bir hata olu≈ütu');
            return data;
        }

        // Dashboard
        async function loadDashboard() {
            try {
                const stats = await apiRequest('/reports/overview');
                document.getElementById('statStudents').textContent = stats.totalStudents;
                document.getElementById('statTeachers').textContent = stats.totalTeachers;
                document.getElementById('statHours').textContent = stats.totalVolunteerHours;
                document.getElementById('statPending').textContent = stats.pendingActivities;

                // Load top lists
                const [students, schools] = await Promise.all([
                    apiRequest('/reports/top-students?limit=5'),
                    apiRequest('/reports/top-schools?limit=5')
                ]);

                renderTopList('topStudentsList', students, 'saat');
                renderTopList('topSchoolsList', schools, 'saat');

                // Load charts
                loadCharts();
            } catch (e) {
                console.error('Dashboard error:', e);
            }
        }

        function renderTopList(elementId, items, suffix) {
            const container = document.getElementById(elementId);
            if (items.length === 0) {
                container.innerHTML = '<p class="text-sm text-slate-400 text-center">Hen√ºz veri yok</p>';
                return;
            }

            container.innerHTML = items.map((item, i) => `
                <div class="flex items-center justify-between p-3 rounded-xl bg-slate-50 hover:bg-white transition border border-slate-100">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg ${i < 3 ? 'bg-amber-400 text-white' : 'bg-slate-200 text-slate-600'} flex items-center justify-center font-bold text-sm">${i + 1}</div>
                        <div>
                            <p class="font-bold text-sm text-slate-800">${item.name || item.schoolName}</p>
                            <p class="text-xs text-slate-500">${item.schoolName || `${item.studentCount} √∂ƒürenci`}</p>
                        </div>
                    </div>
                    <span class="font-black text-losev-blue">${item.totalHours} ${suffix}</span>
                </div>
            `).join('');
        }

        async function loadCharts() {
            try {
                const [monthly, activityTypes] = await Promise.all([
                    apiRequest('/reports/monthly'),
                    apiRequest('/reports/by-activity-type')
                ]);

                // Monthly chart
                new Chart(document.getElementById('monthlyChart'), {
                    type: 'bar',
                    data: {
                        labels: monthly.map(m => `${m.month}. Ay`),
                        datasets: [{
                            label: 'Faaliyet Sayƒ±sƒ±',
                            data: monthly.map(m => m.activityCount),
                            backgroundColor: '#d62828'
                        }, {
                            label: 'Toplam Saat',
                            data: monthly.map(m => m.totalHours),
                            backgroundColor: '#457b9d'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                // Activity type chart
                new Chart(document.getElementById('activityTypeChart'), {
                    type: 'doughnut',
                    data: {
                        labels: activityTypes.map(t => t.type),
                        datasets: [{
                            data: activityTypes.map(t => t.count),
                            backgroundColor: ['#d62828', '#2e7d32', '#f77f00', '#457b9d', '#9e0000', '#fcd5ce', '#e8f5e9']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (e) {
                console.error('Chart error:', e);
            }
        }

        // Activities
        async function loadActivities() {
            try {
                allActivities = await apiRequest('/headoffice/activities');
                renderActivities();
            } catch (e) {
                console.error('Activities error:', e);
            }
        }

        function filterActivities(filter) {
            currentActivityFilter = filter;

            // Update button styles
            ['all', 'pending', 'approved'].forEach(f => {
                const btn = document.getElementById(`filter${f.charAt(0).toUpperCase() + f.slice(1)}`);
                if (f === filter) {
                    btn.classList.remove('bg-white', 'text-slate-600', 'border-slate-200');
                    btn.classList.add('bg-losev-red', 'text-white');
                } else {
                    btn.classList.add('bg-white', 'text-slate-600', 'border-slate-200');
                    btn.classList.remove('bg-losev-red', 'text-white');
                }
            });

            renderActivities();
        }

        function renderActivities() {
            const tbody = document.getElementById('activitiesTableBody');
            let filtered = allActivities;

            if (currentActivityFilter !== 'all') {
                filtered = allActivities.filter(a => a.status === currentActivityFilter);
            }

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-12 text-center text-slate-400">Kayƒ±t bulunamadƒ±</td></tr>`;
                return;
            }

            tbody.innerHTML = filtered.map(a => {
                const statusColors = {
                    pending: 'bg-yellow-100 text-yellow-700',
                    approved: 'bg-green-100 text-green-700',
                    rejected: 'bg-red-100 text-red-700'
                };
                const statusLabels = { pending: 'Bekliyor', approved: 'Onaylandƒ±', rejected: 'Reddedildi' };

                return `
                    <tr class="hover:bg-slate-50">
                        <td class="py-3 px-4 font-medium">${a.studentName}</td>
                        <td class="py-3 px-4 text-sm text-slate-500">${a.schoolName}</td>
                        <td class="py-3 px-4">
                            <span class="text-xs font-bold text-slate-600 bg-slate-100 px-2 py-1 rounded">${a.type}</span>
                            <p class="text-xs text-slate-400 mt-1">${a.description?.substring(0, 30)}...</p>
                        </td>
                        <td class="py-3 px-4 text-center font-bold">${a.hours}</td>
                        <td class="py-3 px-4 text-center">
                            <span class="px-2 py-1 rounded-full text-xs font-bold ${statusColors[a.status]}">${statusLabels[a.status]}</span>
                        </td>
                        <td class="py-3 px-4 text-right">
                            ${a.status === 'pending' ? `
                                <button onclick="updateActivityStatus('${a.id}', 'approved')" class="text-green-600 hover:text-green-800 mr-2">‚úì</button>
                                <button onclick="updateActivityStatus('${a.id}', 'rejected')" class="text-red-600 hover:text-red-800">‚úó</button>
                            ` : '-'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function updateActivityStatus(id, status) {
            if (!confirm(`Bu faaliyeti ${status === 'approved' ? 'onaylamak' : 'reddetmek'} istediƒüinize emin misiniz?`)) return;
            try {
                await apiRequest(`/headoffice/activities/${id}/status`, 'PATCH', { status });
                loadActivities();
                loadDashboard();
            } catch (e) {
                alert(e.message);
            }
        }

        // Students
        async function loadStudents() {
            try {
                allStudents = await apiRequest('/headoffice/students');
                renderStudents(allStudents);
            } catch (e) {
                console.error('Students error:', e);
            }
        }

        function renderStudents(students) {
            const tbody = document.getElementById('studentsTableBody');

            if (students.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-12 text-center text-slate-400">√ñƒürenci bulunamadƒ±</td></tr>`;
                return;
            }

            tbody.innerHTML = students.map(s => `
                <tr class="hover:bg-slate-50">
                    <td class="py-3 px-4 font-medium">${s.firstName} ${s.lastName}</td>
                    <td class="py-3 px-4 text-sm">${s.schoolName || '-'}</td>
                    <td class="py-3 px-4 text-sm text-slate-500">${s.city || '-'}/${s.district || '-'}</td>
                    <td class="py-3 px-4 text-sm">${s.grade || '-'}</td>
                    <td class="py-3 px-4 text-sm">${s.coordinatorTeacherName || '-'}</td>
                    <td class="py-3 px-4 text-center">
                        <button onclick="viewStudentReport('${s.id}')" class="text-losev-blue hover:underline text-sm">Rapor</button>
                    </td>
                </tr>
            `).join('');
        }

        function searchStudents() {
            const query = document.getElementById('studentSearch').value.toLowerCase();
            const filtered = allStudents.filter(s =>
                `${s.firstName} ${s.lastName}`.toLowerCase().includes(query) ||
                s.schoolName?.toLowerCase().includes(query) ||
                s.city?.toLowerCase().includes(query)
            );
            renderStudents(filtered);
        }

        function viewStudentReport(studentId) {
            window.open(`profile.html?id=${studentId}&report=true`, '_blank');
        }

        // Reports
        async function loadReports() {
            try {
                const [stats, schools] = await Promise.all([
                    apiRequest('/reports/overview'),
                    apiRequest('/reports/schools')
                ]);

                document.getElementById('statTotalSchools').textContent = stats.totalSchools;
                document.getElementById('statTotalCities').textContent = stats.totalCities;
                document.getElementById('statApprovedActivities').textContent = stats.approvedActivities;

                // Schools report table
                const tbody = document.getElementById('schoolsReportTable');
                tbody.innerHTML = schools.map((s, i) => `
                    <tr class="hover:bg-slate-50">
                        <td class="py-3 px-4 font-bold">${i + 1}</td>
                        <td class="py-3 px-4 font-medium">${s.schoolName}</td>
                        <td class="py-3 px-4 text-center">${s.studentCount}</td>
                        <td class="py-3 px-4 text-center font-bold text-losev-blue">${s.totalHours}</td>
                        <td class="py-3 px-4 text-center">${s.studentCount > 0 ? (s.totalHours / s.studentCount).toFixed(1) : 0}</td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Reports error:', e);
            }
        }

        // Cities
        async function loadCityStats() {
            try {
                const cities = await apiRequest('/reports/by-city');

                const tbody = document.getElementById('citiesTable');
                tbody.innerHTML = cities.map((c, i) => `
                    <tr class="hover:bg-slate-50">
                        <td class="py-3 px-4 font-bold">${i + 1}</td>
                        <td class="py-3 px-4 font-medium">${c.city}</td>
                        <td class="py-3 px-4 text-center">${c.studentCount}</td>
                        <td class="py-3 px-4 text-center">${c.activityCount}</td>
                        <td class="py-3 px-4 text-center font-bold text-losev-blue">${c.totalHours}</td>
                    </tr>
                `).join('');

                // City charts
                new Chart(document.getElementById('cityChart'), {
                    type: 'pie',
                    data: {
                        labels: cities.slice(0, 8).map(c => c.city),
                        datasets: [{
                            data: cities.slice(0, 8).map(c => c.studentCount),
                            backgroundColor: ['#d62828', '#2e7d32', '#f77f00', '#457b9d', '#9e0000', '#8b5cf6', '#ec4899', '#10b981']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                new Chart(document.getElementById('cityHoursChart'), {
                    type: 'bar',
                    data: {
                        labels: cities.slice(0, 8).map(c => c.city),
                        datasets: [{
                            label: 'Toplam Saat',
                            data: cities.slice(0, 8).map(c => c.totalHours),
                            backgroundColor: '#457b9d'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (e) {
                console.error('Cities error:', e);
            }
        }
    </script>
</body>
</html>
